<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>No-Settings Sync Test - World Wide Notes</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        .header h1 {
            color: #333;
            margin: 0;
            font-size: 2.5em;
        }
        .header p {
            color: #666;
            margin: 10px 0 0 0;
            font-size: 1.1em;
        }
        .status-card {
            background: #f8f9fa;
            border: 2px solid #dee2e6;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
        }
        .status-good { border-color: #28a745; background: #d4edda; }
        .status-warning { border-color: #ffc107; background: #fff3cd; }
        .status-error { border-color: #dc3545; background: #f8d7da; }
        
        .test-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 25px 0;
        }
        
        .test-button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 20px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            min-height: 100px;
        }
        
        .test-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.2);
        }
        
        .test-icon {
            font-size: 24px;
            margin-bottom: 10px;
        }
        
        .documents-list {
            margin-top: 25px;
            max-height: 400px;
            overflow-y: auto;
            border: 2px solid #dee2e6;
            border-radius: 10px;
            background: #f8f9fa;
        }
        
        .document-item {
            padding: 15px 20px;
            border-bottom: 1px solid #dee2e6;
            background: white;
            margin: 5px;
            border-radius: 8px;
            display: flex;
            justify-content: between;
            align-items: center;
        }
        
        .document-info {
            flex-grow: 1;
        }
        
        .document-title {
            font-weight: bold;
            color: #333;
            font-size: 16px;
            margin-bottom: 5px;
        }
        
        .document-meta {
            font-size: 12px;
            color: #666;
            line-height: 1.4;
        }
        
        .document-actions {
            display: flex;
            gap: 10px;
        }
        
        .action-btn {
            padding: 5px 10px;
            font-size: 12px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            background: #17a2b8;
            color: white;
        }
        
        .action-btn:hover {
            background: #138496;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 25px 0;
        }
        
        .stat-card {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }
        
        .stat-number {
            font-size: 2.5em;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .stat-label {
            font-size: 14px;
            opacity: 0.9;
        }
        
        .log-area {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 5px;
            padding: 15px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            max-height: 200px;
            overflow-y: auto;
            margin-top: 20px;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üöÄ No-Settings Sync Test</h1>
            <p>Testing document sync without any Cloudinary settings changes</p>
        </div>

        <div id="syncStatus" class="status-card">
            <h3>üîß Sync Status</h3>
            <p id="statusMessage">Initializing...</p>
        </div>

        <div class="stats-grid">
            <div class="stat-card">
                <div id="totalDocs" class="stat-number">0</div>
                <div class="stat-label">Total Documents</div>
            </div>
            <div class="stat-card" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                <div id="syncMethods" class="stat-number">0</div>
                <div class="stat-label">Active Sync Methods</div>
            </div>
            <div class="stat-card" style="background: linear-gradient(135deg, #fd7e14 0%, #e83e8c 100%);">
                <div id="lastSync" class="stat-number">Never</div>
                <div class="stat-label">Last Sync</div>
            </div>
        </div>

        <div class="test-grid">
            <button class="test-button" onclick="testSyncSystem()">
                <div class="test-icon">üîÑ</div>
                <div>Test Sync System</div>
            </button>
            <button class="test-button" onclick="loadDocuments()">
                <div class="test-icon">üì•</div>
                <div>Load Documents</div>
            </button>
            <button class="test-button" onclick="simulateUpload()">
                <div class="test-icon">üì§</div>
                <div>Simulate Upload</div>
            </button>
            <button class="test-button" onclick="clearAllData()">
                <div class="test-icon">üóëÔ∏è</div>
                <div>Clear All Data</div>
            </button>
            <button class="test-button" onclick="testCrossTab()">
                <div class="test-icon">üì°</div>
                <div>Test Cross-Tab</div>
            </button>
            <button class="test-button" onclick="showStorageInfo()">
                <div class="test-icon">üíæ</div>
                <div>Storage Info</div>
            </button>
            <button class="test-button" onclick="detectUploads()">
                <div class="test-icon">üîç</div>
                <div>Detect Uploads</div>
            </button>
            <button class="test-button" onclick="manualDetect()">
                <div class="test-icon">üìù</div>
                <div>Manual Detect</div>
            </button>
            <button class="test-button" onclick="quickResumeSearch()">
                <div class="test-icon">üìã</div>
                <div>Quick Resume Search</div>
            </button>
            <button class="test-button" onclick="comprehensiveResumeSearch()">
                <div class="test-icon">üîé</div>
                <div>Full Resume Search</div>
            </button>
            <button class="test-button" onclick="runDiagnostics()" style="background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);">
                <div class="test-icon">üîç</div>
                <div>Debug Resume Issue</div>
            </button>
            <button class="test-button" onclick="testDirectUrls()" style="background: linear-gradient(135deg, #9b59b6 0%, #8e44ad 100%);">
                <div class="test-icon">üåê</div>
                <div>Test Direct URLs</div>
            </button>
            <button class="test-button" onclick="addAllFoundResumes()" style="background: linear-gradient(135deg, #27ae60 0%, #229954 100%);">
                <div class="test-icon">üöÄ</div>
                <div>Add All Resumes NOW</div>
            </button>
            <button class="test-button" onclick="forceAddResumes()" style="background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%); animation: pulse 2s infinite;">
                <div class="test-icon">‚ö°</div>
                <div>FORCE ADD RESUMES</div>
            </button>
        </div>

        <div style="margin: 20px 0;">
            <h3>üîç Debug Log:</h3>
            <div id="debugLog" style="background: #1e1e1e; color: #00ff00; padding: 15px; border-radius: 5px; height: 200px; overflow-y: auto; font-family: 'Courier New', monospace; font-size: 12px; border: 1px solid #333;">
                Debug information will appear here...
            </div>
        </div>

        <div>
            <h3>üìã Documents:</h3>
            <div id="documentsList" class="documents-list">
                <div style="text-align: center; color: #666; padding: 40px;">
                    <div style="font-size: 50px; margin-bottom: 10px;">üì≠</div>
                    <p>No documents loaded yet</p>
                    <small>Click "Load Documents" to test</small>
                </div>
            </div>
        </div>

        <div>
            <h3>üìù Test Log:</h3>
            <div id="testLog" class="log-area">
                Ready to test...
            </div>
        </div>
    </div>

    <!-- Include required scripts -->
    <script src="js/config.js"></script>
    <script src="js/global-document-registry.js"></script>
    <script src="js/no-settings-sync.js"></script>
    <script src="js/upload-detector.js"></script>
    <script src="js/resume-detector.js"></script>
    <script src="js/debug-resume-sync.js"></script>
    
    <script>
        let testLog = [];
        let noSettingsSync = null;

        // Initialize sync system when page loads
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(async () => {
                try {
                    // The sync system is already initialized automatically
                    // We just need to reference the global instance
                    if (window.noSettingsSync) {
                        noSettingsSync = window.noSettingsSync;
                        log('‚úÖ Using existing no-settings sync instance');
                        updateStatus('‚úÖ Sync system ready', 'success');
                    } else if (window.NoSettingsCloudinarySync) {
                        noSettingsSync = new window.NoSettingsCloudinarySync();
                        await noSettingsSync.initialize();
                        log('‚úÖ No-settings sync system initialized successfully');
                        updateStatus('‚úÖ Sync system ready', 'success');
                    } else {
                        log('‚ùå NoSettingsCloudinarySync class not found');
                        updateStatus('‚ùå Sync system failed to load', 'error');
                    }
                } catch (error) {
                    log(`‚ùå Sync system initialization failed: ${error.message}`);
                    updateStatus('‚ùå Sync system initialization failed', 'error');
                }
            }, 1000);
        });

        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = `[${timestamp}] ${message}`;
            testLog.push(logEntry);
            
            // Update log display
            const logArea = document.getElementById('testLog');
            logArea.textContent = testLog.slice(-20).join('\n'); // Show last 20 entries
            logArea.scrollTop = logArea.scrollHeight;
            
            console.log(logEntry);
        }

        function updateStatus(message, type = 'good') {
            const statusDiv = document.getElementById('syncStatus');
            const messageP = document.getElementById('statusMessage');
            
            statusDiv.className = `status-card status-${type}`;
            messageP.textContent = message;
        }

        function updateStats(docs, methods, lastSync) {
            document.getElementById('totalDocs').textContent = docs;
            document.getElementById('syncMethods').textContent = methods;
            document.getElementById('lastSync').textContent = lastSync;
        }

        async function testSyncSystem() {
            log('üîÑ Testing sync system...');
            updateStatus('Testing sync system...', 'warning');
            
            try {
                // Check if sync system is available
                if (!window.noSettingsSync && !window.instantSync) {
                    throw new Error('No sync system available');
                }
                
                const syncService = window.noSettingsSync || window.instantSync;
                log('‚úÖ Sync service found');
                
                // Test storage methods
                let activeMethods = 0;
                
                // Test localStorage
                try {
                    localStorage.setItem('test_sync', 'test');
                    localStorage.removeItem('test_sync');
                    activeMethods++;
                    log('‚úÖ localStorage available');
                } catch (e) {
                    log('‚ùå localStorage not available');
                }
                
                // Test sessionStorage
                try {
                    sessionStorage.setItem('test_sync', 'test');
                    sessionStorage.removeItem('test_sync');
                    activeMethods++;
                    log('‚úÖ sessionStorage available');
                } catch (e) {
                    log('‚ùå sessionStorage not available');
                }
                
                updateStats('-', activeMethods, new Date().toLocaleTimeString());
                updateStatus(`‚úÖ Sync system ready! ${activeMethods} storage methods active`, 'good');
                log(`‚úÖ Sync system test complete - ${activeMethods} methods active`);
                
            } catch (error) {
                updateStatus(`‚ùå Sync system error: ${error.message}`, 'error');
                log(`‚ùå Sync system test failed: ${error.message}`);
            }
        }

        async function loadDocuments() {
            log('üì• Loading documents...');
            updateStatus('Loading documents...', 'warning');
            
            try {
                const syncService = window.noSettingsSync || window.instantSync;
                if (!syncService) {
                    throw new Error('Sync service not available');
                }

                const documents = await syncService.loadDocuments();
                log(`üìä Loaded ${documents.length} documents`);
                
                updateStats(documents.length, '-', new Date().toLocaleTimeString());
                updateStatus(`‚úÖ Loaded ${documents.length} documents`, 'good');
                
                displayDocuments(documents);
                
            } catch (error) {
                updateStatus(`‚ùå Load error: ${error.message}`, 'error');
                log(`‚ùå Load failed: ${error.message}`);
            }
        }

        function displayDocuments(documents) {
            const listDiv = document.getElementById('documentsList');
            
            if (documents.length === 0) {
                listDiv.innerHTML = `
                    <div style="text-align: center; color: #666; padding: 40px;">
                        <div style="font-size: 50px; margin-bottom: 10px;">üì≠</div>
                        <p>No documents found</p>
                        <small>Try uploading a document first</small>
                    </div>
                `;
                return;
            }

            const html = documents.map((doc, index) => `
                <div class="document-item">
                    <div class="document-info">
                        <div class="document-title">${doc.title}</div>
                        <div class="document-meta">
                            üìö ${doc.subject} | üìÑ ${doc.type} | üìÖ ${doc.year}<br>
                            üíæ ${doc.fileSize || 'Unknown size'} | üÜî ${doc.cloudinaryPublicId || doc.id}<br>
                            ‚è∞ ${new Date(doc.uploadDate).toLocaleString()}
                        </div>
                    </div>
                    <div class="document-actions">
                        ${doc.cloudinaryUrl ? `<button class="action-btn" onclick="window.open('${doc.cloudinaryUrl}', '_blank')">View</button>` : ''}
                        <button class="action-btn" onclick="removeDocument('${doc.id || doc.cloudinaryPublicId}')">Remove</button>
                    </div>
                </div>
            `).join('');
            
            listDiv.innerHTML = html;
        }

        async function simulateUpload() {
            log('üì§ Simulating document upload...');
            
            try {
                const testDoc = {
                    id: `test_${Date.now()}`,
                    title: `Test Document ${new Date().toLocaleTimeString()}`,
                    description: 'This is a test document created by the sync tester',
                    subject: 'computer-science',
                    type: 'notes',
                    year: 2024,
                    cloudinaryUrl: 'https://res.cloudinary.com/dpfrv7kmo/raw/upload/test_file.pdf',
                    cloudinaryPublicId: `test_${Date.now()}`,
                    fileSize: '1.2 MB',
                    uploadDate: new Date().toISOString(),
                    tags: ['test', 'sync'],
                    uploadedBy: 'Test System',
                    isCloudinary: true
                };

                const syncService = window.noSettingsSync || window.instantSync;
                if (!syncService) {
                    throw new Error('Sync service not available');
                }

                const success = await syncService.saveDocument(testDoc);
                
                if (success) {
                    log(`‚úÖ Test upload successful: ${testDoc.title}`);
                    updateStatus('‚úÖ Test upload successful!', 'good');
                    
                    // Reload documents to show the new one
                    setTimeout(() => loadDocuments(), 1000);
                } else {
                    throw new Error('Save method returned false');
                }
                
            } catch (error) {
                log(`‚ùå Simulate upload failed: ${error.message}`);
                updateStatus(`‚ùå Upload simulation failed: ${error.message}`, 'error');
            }
        }

        async function clearAllData() {
            log('üóëÔ∏è Clearing all sync data...');
            
            try {
                // Clear all storage keys
                const keys = [
                    'wwnotes_nosettings_sync',
                    'wwnotes_backup_1',
                    'wwnotes_backup_2',
                    'cloudinaryCachedDocs',
                    'wwnotes_session_sync',
                    'wwnotes_latest_session',
                    'wwnotes_broadcast',
                    'wwnotes_new_doc',
                    'tab_communication'
                ];
                
                keys.forEach(key => {
                    localStorage.removeItem(key);
                    sessionStorage.removeItem(key);
                });
                
                log('‚úÖ All sync data cleared');
                updateStatus('‚úÖ All data cleared', 'good');
                updateStats(0, '-', 'Cleared');
                
                // Clear display
                document.getElementById('documentsList').innerHTML = `
                    <div style="text-align: center; color: #666; padding: 40px;">
                        <div style="font-size: 50px; margin-bottom: 10px;">üóëÔ∏è</div>
                        <p>All data cleared</p>
                        <small>Upload or simulate documents to test sync</small>
                    </div>
                `;
                
            } catch (error) {
                log(`‚ùå Clear data failed: ${error.message}`);
                updateStatus(`‚ùå Clear failed: ${error.message}`, 'error');
            }
        }

        function testCrossTab() {
            log('üì° Testing cross-tab communication...');
            
            try {
                const testBroadcast = {
                    type: 'test',
                    message: 'Cross-tab test from ' + new Date().toLocaleTimeString(),
                    timestamp: Date.now()
                };
                
                localStorage.setItem('wwnotes_broadcast', JSON.stringify(testBroadcast));
                log('‚úÖ Cross-tab test message sent');
                updateStatus('‚úÖ Cross-tab test sent', 'good');
                
            } catch (error) {
                log(`‚ùå Cross-tab test failed: ${error.message}`);
                updateStatus(`‚ùå Cross-tab test failed: ${error.message}`, 'error');
            }
        }

        function showStorageInfo() {
            log('üíæ Checking storage information...');
            
            try {
                let totalItems = 0;
                let totalSize = 0;
                
                // Check localStorage
                for (let key in localStorage) {
                    if (key.includes('wwnotes') || key.includes('cloudinary')) {
                        totalItems++;
                        totalSize += localStorage[key].length;
                    }
                }
                
                log(`üìä Storage info: ${totalItems} items, ~${Math.round(totalSize/1024)}KB`);
                updateStatus(`üíæ Storage: ${totalItems} items, ~${Math.round(totalSize/1024)}KB`, 'good');
                
            } catch (error) {
                log(`‚ùå Storage info failed: ${error.message}`);
                updateStatus(`‚ùå Storage info failed: ${error.message}`, 'error');
            }
        }

        function removeDocument(docId) {
            log(`üóëÔ∏è Removing document: ${docId}`);
            // This would implement document removal
            // For now, just refresh the display
            loadDocuments();
        }

        async function detectUploads() {
            log('üîç Starting upload detection...');
            updateStatus('Detecting existing uploads...', 'warning');
            
            try {
                if (!window.uploadDetector) {
                    throw new Error('Upload detector not available');
                }
                
                // Trigger existing upload detection
                await window.uploadDetector.detectExistingUploads();
                
                // Get detected uploads
                const detectedUploads = window.uploadDetector.getAllDetectedUploads();
                log(`‚úÖ Detection complete - found ${detectedUploads.length} uploads`);
                
                updateStatus(`‚úÖ Found ${detectedUploads.length} existing uploads`, 'good');
                
                // Refresh display
                setTimeout(() => loadDocuments(), 1000);
                
            } catch (error) {
                log(`‚ùå Upload detection failed: ${error.message}`);
                updateStatus(`‚ùå Detection failed: ${error.message}`, 'error');
            }
        }

        async function manualDetect() {
            log('üìù Manual upload detection...');
            
            try {
                if (!window.uploadDetector) {
                    throw new Error('Upload detector not available');
                }
                
                // Try to detect common file names including resume
                const commonFiles = [
                    'resume.pdf',
                    'cv.pdf',
                    'resume.doc',
                    'cv.doc',
                    'resume.docx',
                    'cv.docx',
                    'document.pdf',
                    'notes.pdf',
                    'file.pdf'
                ];
                
                updateStatus('Scanning for common file names...', 'warning');
                
                let foundCount = 0;
                for (const filename of commonFiles) {
                    try {
                        await window.uploadDetector.manualDetectFile(filename);
                        log(`üîç Scanned for: ${filename}`);
                        
                        // Small delay to avoid overwhelming the server
                        await new Promise(resolve => setTimeout(resolve, 500));
                        
                    } catch (error) {
                        log(`‚ö†Ô∏è Scan failed for ${filename}: ${error.message}`);
                    }
                }
                
                // Get updated count
                const detectedUploads = window.uploadDetector.getAllDetectedUploads();
                log(`‚úÖ Manual detection complete - total detected: ${detectedUploads.length}`);
                
                updateStatus(`‚úÖ Manual scan complete - ${detectedUploads.length} total detected`, 'good');
                
                // Refresh display
                setTimeout(() => loadDocuments(), 2000);
                
            } catch (error) {
            log(`‚ùå Manual detection failed: ${error.message}`);
            updateStatus(`‚ùå Manual detection failed: ${error.message}`, 'error');
        }
    }

    // Resume detection functions
    async function quickResumeSearch() {
        try {
            updateStatus('üîç Running quick resume search...', 'info');
            log('üìã Starting quick resume search...');
            
            if (window.resumeDetector) {
                const resumes = await window.resumeDetector.quickResumeSearch();
                
                if (resumes.length > 0) {
                    log(`üìã Quick search found ${resumes.length} resume(s):`);
                    
                    for (const resume of resumes) {
                        log(`  ‚úÖ ${resume.fileName} - ${resume.cloudinaryUrl}`);
                        
                        // Save to sync system
                        await noSettingsSync.saveDocument(resume);
                    }
                    
                    updateStatus(`üìã Found ${resumes.length} resume(s) via quick search!`, 'success');
                    loadDocuments(); // Refresh display
                } else {
                    log('üìã No resumes found in quick search');
                    updateStatus('üìã No resumes found in quick search', 'warning');
                }
            } else {
                throw new Error('Resume detector not loaded');
            }
            
        } catch (error) {
            log(`‚ùå Quick resume search failed: ${error.message}`);
            updateStatus(`‚ùå Quick resume search failed: ${error.message}`, 'error');
        }
    }

    async function comprehensiveResumeSearch() {
        try {
            updateStatus('üîé Running comprehensive resume search...', 'info');
            log('üìã Starting comprehensive resume search...');
            
            if (window.resumeDetector) {
                const resumes = await window.resumeDetector.findResume();
                
                if (resumes.length > 0) {
                    log(`üìã Comprehensive search found ${resumes.length} resume(s):`);
                    
                    for (const resume of resumes) {
                        log(`  ‚úÖ ${resume.fileName} - ${resume.cloudinaryUrl}`);
                        
                        // Save to sync system
                        await noSettingsSync.saveDocument(resume);
                    }
                    
                    updateStatus(`üìã Found ${resumes.length} resume(s) via comprehensive search!`, 'success');
                    loadDocuments(); // Refresh display
                } else {
                    log('üìã No resumes found in comprehensive search');
                    updateStatus('üìã No resumes found in comprehensive search', 'warning');
                }
            } else {
                throw new Error('Resume detector not loaded');
            }
            
        } catch (error) {
            log(`‚ùå Comprehensive resume search failed: ${error.message}`);
            updateStatus(`‚ùå Comprehensive resume search failed: ${error.message}`, 'error');
        }
    }

    // Debug functions
    async function runDiagnostics() {
        try {
            updateStatus('üîç Running full diagnostics...', 'info');
            log('üîç Starting resume sync diagnostics...');
            
            if (window.resumeDebugger) {
                const results = await window.resumeDebugger.runFullDiagnostics();
                
                updateStatus(`üîç Diagnostics complete - found ${results.foundFiles.length} files`, 
                    results.foundFiles.length > 0 ? 'success' : 'warning');
                
                if (results.foundFiles.length > 0) {
                    log('üéâ FOUND FILES - Adding to sync system...');
                    
                        if (!noSettingsSync) {
                            log('‚ùå Sync system not initialized, attempting to initialize...');
                            try {
                                if (window.noSettingsSync) {
                                    noSettingsSync = window.noSettingsSync;
                                } else {
                                    noSettingsSync = new window.NoSettingsCloudinarySync();
                                    await noSettingsSync.initialize();
                                }
                                log('‚úÖ Sync system initialized successfully');
                            } catch (error) {
                                log(`‚ùå Failed to initialize sync system: ${error.message}`);
                                updateStatus('‚ùå Cannot save files - sync system not available', 'error');
                                return;
                            }
                        }                    for (const file of results.foundFiles) {
                        const document = {
                            id: `found_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,
                            title: `Found: ${file.filename}`,
                            description: 'File found via diagnostics',
                            subject: 'resume',
                            type: 'document',
                            year: new Date().getFullYear(),
                            cloudinaryUrl: file.url,
                            cloudinaryPublicId: file.filename,
                            fileName: file.filename.split('/').pop(),
                            originalName: file.filename.split('/').pop(),
                            fileSize: 'Unknown',
                            uploadDate: new Date().toISOString(),
                            tags: ['resume', 'found', 'diagnostics'],
                            uploadedBy: 'Diagnostics',
                            isCloudinary: true,
                            method: file.method
                        };
                        
                        try {
                            await noSettingsSync.saveDocument(document);
                            log(`‚úÖ Added to sync: ${file.filename}`);
                        } catch (error) {
                            log(`‚ùå Failed to save ${file.filename}: ${error.message}`);
                        }
                    }
                    
                    loadDocuments(); // Refresh display
                }
            } else {
                throw new Error('Debug system not loaded');
            }
            
        } catch (error) {
            log(`‚ùå Diagnostics failed: ${error.message}`);
            updateStatus(`‚ùå Diagnostics failed: ${error.message}`, 'error');
        }
    }

    async function testDirectUrls() {
        try {
            updateStatus('üåê Testing direct Cloudinary URLs...', 'info');
            log('üåê Testing direct URL patterns...');
            
            if (window.resumeDebugger) {
                const foundFiles = await window.resumeDebugger.testDirectCloudinaryAccess();
                
                if (foundFiles.length > 0) {
                    updateStatus(`üåê Found ${foundFiles.length} files via direct URL testing!`, 'success');
                    
                    for (const file of foundFiles) {
                        log(`‚úÖ Direct URL success: ${file.filename} -> ${file.url}`);
                        
                        // Add to sync system
                        const document = {
                            id: `direct_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,
                            title: `Direct: ${file.filename}`,
                            description: 'File found via direct URL testing',
                            subject: 'resume',
                            type: 'document',
                            year: new Date().getFullYear(),
                            cloudinaryUrl: file.url,
                            cloudinaryPublicId: file.filename,
                            fileName: file.filename.split('/').pop(),
                            originalName: file.filename.split('/').pop(),
                            fileSize: 'Unknown',
                            uploadDate: new Date().toISOString(),
                            tags: ['resume', 'direct-url', 'found'],
                            uploadedBy: 'Direct URL Test',
                            isCloudinary: true
                        };
                        
                        await noSettingsSync.saveDocument(document);
                    }
                    
                    loadDocuments(); // Refresh display
                } else {
                    updateStatus('üåê No files found via direct URL testing', 'warning');
                }
            } else {
                throw new Error('Debug system not loaded');
            }
            
        } catch (error) {
            log(`‚ùå Direct URL testing failed: ${error.message}`);
            updateStatus(`‚ùå Direct URL testing failed: ${error.message}`, 'error');
        }
    }

    // Quick fix function to add all found resumes
    async function addAllFoundResumes() {
        try {
            updateStatus('üöÄ Adding all found resumes...', 'info');
            log('üöÄ Starting mass resume addition...');
            
            // Initialize sync system if needed
            if (!noSettingsSync) {
                log('üîß Initializing sync system...');
                if (window.noSettingsSync) {
                    noSettingsSync = window.noSettingsSync;
                } else {
                    noSettingsSync = new window.NoSettingsCloudinarySync();
                    await noSettingsSync.initialize();
                }
                log('‚úÖ Sync system ready');
            }
            
            // Predefined list of found resume URLs from the debug log
            const foundResumeUrls = [
                'https://res.cloudinary.com/dpfrv7kmo/raw/upload/new_cv.pdf',
                'https://res.cloudinary.com/dpfrv7kmo/raw/upload/resume.pdf',
                'https://res.cloudinary.com/dpfrv7kmo/raw/upload/world-wide-notes/my_resume.pdf',
                'https://res.cloudinary.com/dpfrv7kmo/raw/upload/cv.pdf',
                'https://res.cloudinary.com/dpfrv7kmo/raw/upload/mobile_resume.pdf',
                'https://res.cloudinary.com/dpfrv7kmo/raw/upload/Resume.pdf',
                'https://res.cloudinary.com/dpfrv7kmo/raw/upload/phone_resume.pdf',
                'https://res.cloudinary.com/dpfrv7kmo/raw/upload/world-wide-notes/resume.pdf',
                'https://res.cloudinary.com/dpfrv7kmo/raw/upload/my_resume.pdf',
                'https://res.cloudinary.com/dpfrv7kmo/raw/upload/resume_final.pdf',
                'https://res.cloudinary.com/dpfrv7kmo/raw/upload/resume_latest.pdf',
                'https://res.cloudinary.com/dpfrv7kmo/raw/upload/new_resume.pdf'
            ];
            
            let addedCount = 0;
            
            for (let i = 0; i < foundResumeUrls.length; i++) {
                const url = foundResumeUrls[i];
                const filename = url.split('/').pop();
                
                const document = {
                    id: `quick_resume_${Date.now()}_${i}`,
                    title: `Resume: ${filename.replace(/[_-]/g, ' ').replace('.pdf', '').replace('.doc', '').replace('.docx', '')}`,
                    description: `Resume file found in Cloudinary: ${filename}`,
                    subject: 'resume',
                    type: 'resume',
                    year: new Date().getFullYear(),
                    cloudinaryUrl: url,
                    cloudinaryPublicId: url.split('/raw/upload/')[1],
                    fileName: filename,
                    originalName: filename,
                    fileSize: 'Unknown',
                    uploadDate: new Date().toISOString(),
                    tags: ['resume', 'cv', 'quick-add', 'found'],
                    uploadedBy: 'Quick Resume Add',
                    isCloudinary: true,
                    isResume: true
                };
                
                try {
                    await noSettingsSync.saveDocument(document);
                    addedCount++;
                    log(`‚úÖ Added resume ${addedCount}: ${filename}`);
                } catch (error) {
                    log(`‚ùå Failed to add ${filename}: ${error.message}`);
                }
                
                // Small delay to prevent overwhelming the system
                await new Promise(resolve => setTimeout(resolve, 100));
            }
            
            log(`üéâ Successfully added ${addedCount} resume files!`);
            updateStatus(`üéâ Added ${addedCount} resume files to your library!`, 'success');
            
            // Refresh the documents display
            loadDocuments();
            
        } catch (error) {
            log(`‚ùå Mass resume addition failed: ${error.message}`);
            updateStatus(`‚ùå Failed to add resumes: ${error.message}`, 'error');
        }
    }

    // Force add resumes directly to localStorage (bypasses all initialization issues)
    function forceAddResumes() {
        try {
            updateStatus('‚ö° FORCE adding resumes directly...', 'info');
            log('‚ö° Starting FORCE resume addition...');
            
            // Direct localStorage manipulation
            const resumeUrls = [
                'https://res.cloudinary.com/dpfrv7kmo/raw/upload/resume.pdf',
                'https://res.cloudinary.com/dpfrv7kmo/raw/upload/mobile_resume.pdf',
                'https://res.cloudinary.com/dpfrv7kmo/raw/upload/phone_resume.pdf',
                'https://res.cloudinary.com/dpfrv7kmo/raw/upload/my_resume.pdf',
                'https://res.cloudinary.com/dpfrv7kmo/raw/upload/Resume.pdf',
                'https://res.cloudinary.com/dpfrv7kmo/raw/upload/cv.pdf',
                'https://res.cloudinary.com/dpfrv7kmo/raw/upload/new_resume.pdf',
                'https://res.cloudinary.com/dpfrv7kmo/raw/upload/resume_final.pdf',
                'https://res.cloudinary.com/dpfrv7kmo/raw/upload/world-wide-notes/resume.pdf',
                'https://res.cloudinary.com/dpfrv7kmo/raw/upload/world-wide-notes/mobile_resume.pdf'
            ];
            
            const documents = [];
            
            resumeUrls.forEach((url, index) => {
                const filename = url.split('/').pop();
                const document = {
                    id: `force_resume_${Date.now()}_${index}`,
                    title: `üìã ${filename.replace(/[_-]/g, ' ').replace('.pdf', '').replace('.doc', '').replace('.docx', '').toUpperCase()}`,
                    description: `Resume file: ${filename}`,
                    subject: 'resume',
                    type: 'resume',
                    year: new Date().getFullYear(),
                    cloudinaryUrl: url,
                    cloudinaryPublicId: url.split('/raw/upload/')[1],
                    fileName: filename,
                    originalName: filename,
                    fileSize: 'PDF Document',
                    uploadDate: new Date().toISOString(),
                    tags: ['resume', 'cv', 'force-added'],
                    uploadedBy: 'Force Add System',
                    isCloudinary: true,
                    isResume: true
                };
                
                documents.push(document);
                log(`‚ö° Prepared: ${filename}`);
            });
            
            // Save to multiple storage locations
            const storageKeys = [
                'worldWideNotesDocuments',
                'wwnotes_nosettings_sync',
                'wwnotes_documents',
                'cloudinary_documents'
            ];
            
            storageKeys.forEach(key => {
                try {
                    const existing = JSON.parse(localStorage.getItem(key) || '[]');
                    const combined = [...existing, ...documents];
                    localStorage.setItem(key, JSON.stringify(combined));
                    log(`‚ö° Saved to ${key}`);
                } catch (error) {
                    log(`‚ùå Failed to save to ${key}: ${error.message}`);
                }
            });
            
            // Also save to sessionStorage
            try {
                sessionStorage.setItem('force_added_resumes', JSON.stringify(documents));
                sessionStorage.setItem('worldWideNotesDocuments', JSON.stringify(documents));
                log('‚ö° Saved to sessionStorage');
            } catch (error) {
                log(`‚ùå sessionStorage failed: ${error.message}`);
            }
            
            log(`üéâ FORCE ADDED ${documents.length} RESUMES TO ALL STORAGE!`);
            updateStatus(`üéâ FORCE ADDED ${documents.length} RESUMES!`, 'success');
            
            // Force refresh display
            setTimeout(() => {
                loadDocuments();
            }, 500);
            
        } catch (error) {
            log(`‚ùå Force add failed: ${error.message}`);
            updateStatus(`‚ùå Force add failed: ${error.message}`, 'error');
        }
    }        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', function() {
            log('üöÄ No-Settings Sync Test initialized');
            
            // Wait for sync system to load
            setTimeout(() => {
                testSyncSystem();
            }, 2000);
        });

        // Listen for storage events (cross-tab communication)
        window.addEventListener('storage', function(e) {
            if (e.key && e.key.includes('wwnotes_')) {
                log(`üì° Received cross-tab event: ${e.key}`);
                
                // Refresh documents after cross-tab update
                setTimeout(() => loadDocuments(), 1000);
            }
        });
    </script>
</body>
</html>